"""
AI Helper Module - –ë–ª–æ–∫ –ø–æ–º–æ—â–∏ —Å –Ω–µ–π—Ä–æ–Ω–∫–æ–π
–ú–æ–¥—É–ª—å –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ–¥–∞–∂–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤, –æ–ø–∏—Å–∞–Ω–∏–π —Ç–æ–≤–∞—Ä–æ–≤, –∫–∞—Ä—Ç–æ—á–µ–∫ –∏ –¥—Ä—É–≥–∏—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
"""

import openai
import asyncio
import logging
from typing import Dict, List, Optional
import json
import re

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logger = logging.getLogger(__name__)

class AIHelper:
    """–ü–æ–º–æ—â–Ω–∏–∫ —Å –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–º –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–æ–º –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–¥–∞–∂–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤"""
    
    def __init__(self, api_key: str):
        """
        –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è AI Helper
        
        Args:
            api_key (str): OpenAI API –∫–ª—é—á
        """
        self.api_key = api_key
        openai.api_key = api_key
        
        # –ë–∞–∑–æ–≤—ã–µ –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        self.prompts = {
            'product_description': self._get_product_description_prompt(),
            'product_card': self._get_product_card_prompt(),
            'sales_text': self._get_sales_text_prompt(),
            'ad_copy': self._get_ad_copy_prompt(),
            'social_post': self._get_social_post_prompt(),
            'email_marketing': self._get_email_marketing_prompt(),
            'landing_page': self._get_landing_page_prompt(),
            'seo_content': self._get_seo_content_prompt()
        }
    
    def _get_product_description_prompt(self) -> str:
        """–ü—Ä–æ–º–ø—Ç –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞"""
        return """
–¢—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –ø—Ä–æ–¥–∞—é—â–∏—Ö –æ–ø–∏—Å–∞–Ω–∏–π —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞ Wildberries.

–¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî —Å–æ–∑–¥–∞—Ç—å –ø—Ä–æ–¥–∞—é—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞, –∫–æ—Ç–æ—Ä–æ–µ:
1. –ü—Ä–∏–≤–ª–µ–∫–∞–µ—Ç –≤–Ω–∏–º–∞–Ω–∏–µ –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π
2. –í—ã–¥–µ–ª—è–µ—Ç –∫–ª—é—á–µ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
3. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã
4. –°–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é
5. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–∞ WB

–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï –≠–õ–ï–ú–ï–ù–¢–´:
- –ó–∞–≥–æ–ª–æ–≤–æ–∫ (—è—Ä–∫–∏–π, —Ü–µ–ø–ª—è—é—â–∏–π)
- –û—Å–Ω–æ–≤–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
- –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏ –≤—ã–≥–æ–¥—ã
- –û–±–ª–∞—Å—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è
- –ü—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é
- –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è SEO

–°–¢–ò–õ–¨ –ù–ê–ü–ò–°–ê–ù–ò–Ø:
- –£–±–µ–¥–∏—Ç–µ–ª—å–Ω–æ –∏ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
- –ü—Ä–æ—Å—Ç—ã–º –∏ –ø–æ–Ω—è—Ç–Ω—ã–º —è–∑—ã–∫–æ–º
- –° –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ü–∏—Ñ—Ä –∏ —Ñ–∞–∫—Ç–æ–≤
- –ë–µ–∑ –≤–æ–¥—ã –∏ –ª–∏—à–Ω–∏—Ö —Å–ª–æ–≤

–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–µ: {product_info}

–°–æ–∑–¥–∞–π –ø—Ä–æ–¥–∞—é—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ:
"""

    def _get_product_card_prompt(self) -> str:
        """–ü—Ä–æ–º–ø—Ç –¥–ª—è –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–∞"""
        return """
–¢—ã ‚Äî —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –ø—Ä–æ–¥–∞—é—â–∏—Ö –∫–∞—Ä—Ç–æ—á–µ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è Wildberries.

–°–æ–∑–¥–∞–π –ø–æ–ª–Ω—É—é –∫–∞—Ä—Ç–æ—á–∫—É —Ç–æ–≤–∞—Ä–∞, –≤–∫–ª—é—á–∞—é—â—É—é:

1. –ù–ê–ó–í–ê–ù–ò–ï –¢–û–í–ê–†–ê (60-90 —Å–∏–º–≤–æ–ª–æ–≤):
   - –°–æ–¥–µ—Ä–∂–∏—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
   - –ü—Ä–∏–≤–ª–µ–∫–∞–µ—Ç –≤–Ω–∏–º–∞–Ω–∏–µ
   - –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º WB

2. –û–ü–ò–°–ê–ù–ò–ï (–¥–æ 5000 —Å–∏–º–≤–æ–ª–æ–≤):
   - –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏ —á–∏—Ç–∞–µ–º–æ–µ
   - –° –º–∞—Ä–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Å–ø–∏—Å–∫–∞–º–∏
   - –í—ã–¥–µ–ª—è–µ—Ç –£–¢–ü (—É–Ω–∏–∫–∞–ª—å–Ω–æ–µ —Ç–æ—Ä–≥–æ–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ)

3. –•–ê–†–ê–ö–¢–ï–†–ò–°–¢–ò–ö–ò:
   - –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
   - –†–∞–∑–º–µ—Ä—ã, –≤–µ—Å, –º–∞—Ç–µ—Ä–∏–∞–ª—ã
   - –¶–≤–µ—Ç–∞, –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è

4. –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê:
   - –ß—Ç–æ –ø–æ–ª—É—á–∞–µ—Ç –ø–æ–∫—É–ø–∞—Ç–µ–ª—å
   - –†–µ—à–µ–Ω–∏–µ –∫–∞–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º
   - –í—ã–≥–æ–¥—ã –æ—Ç –ø–æ–∫—É–ø–∫–∏

5. –ò–ù–§–û–ì–†–ê–§–ò–ö–ê (—Ç–µ–∫—Å—Ç–æ–≤—ã–µ –±–ª–æ–∫–∏):
   - –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
   - –°—Ä–∞–≤–Ω–µ–Ω–∏—è —Å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞–º–∏
   - –ì–∞—Ä–∞–Ω—Ç–∏–∏ –∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã

–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–µ: {product_info}

–°–æ–∑–¥–∞–π –ø–æ–ª–Ω—É—é –∫–∞—Ä—Ç–æ—á–∫—É —Ç–æ–≤–∞—Ä–∞:
"""

    def _get_sales_text_prompt(self) -> str:
        """–ü—Ä–æ–º–ø—Ç –¥–ª—è –ø—Ä–æ–¥–∞–∂–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞"""
        return """
–¢—ã ‚Äî —Ç–æ–ø–æ–≤—ã–π –∫–æ–ø–∏—Ä–∞–π—Ç–µ—Ä, —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—â–∏–π—Å—è –Ω–∞ –ø—Ä—è–º—ã—Ö –ø—Ä–æ–¥–∞–∂–∞—Ö.

–°–æ–∑–¥–∞–π –ø—Ä–æ–¥–∞—é—â–∏–π —Ç–µ–∫—Å—Ç –ø–æ —Ñ–æ—Ä–º—É–ª–µ AIDA:
- ATTENTION (–í–Ω–∏–º–∞–Ω–∏–µ) - —Ü–µ–ø–ª—è—é—â–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫
- INTEREST (–ò–Ω—Ç–µ—Ä–µ—Å) - –ø—Ä–æ–±–ª–µ–º–∞ –∏ –µ—ë –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å  
- DESIRE (–ñ–µ–ª–∞–Ω–∏–µ) - –≤—ã–≥–æ–¥—ã –∏ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ—à–µ–Ω–∏—è
- ACTION (–î–µ–π—Å—Ç–≤–∏–µ) - —á–µ—Ç–∫–∏–π –ø—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é

–°–¢–†–£–ö–¢–£–†–ê –¢–ï–ö–°–¢–ê:
1. –ó–∞–≥–æ–ª–æ–≤–æ–∫-–∫—Ä—é—á–æ–∫
2. –ü—Ä–æ–±–ª–µ–º–∞ (–±–æ–ª—å –∫–ª–∏–µ–Ω—Ç–∞)
3. –†–µ—à–µ–Ω–∏–µ (–≤–∞—à —Ç–æ–≤–∞—Ä)
4. –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏ –≤—ã–≥–æ–¥—ã
5. –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞
6. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏/–∫–æ–ª–∏—á–µ—Å—Ç–≤—É
7. –ü—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é

–¢–ï–•–ù–ò–ö–ò –í–û–ó–î–ï–ô–°–¢–í–ò–Ø:
- –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã
- –ü—Ä–∏–Ω—Ü–∏–ø –¥–µ—Ñ–∏—Ü–∏—Ç–∞
- –°–æ—Ü–∏–∞–ª—å–Ω–æ–µ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ
- –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ü–∏—Ñ—Ä—ã –∏ —Ñ–∞–∫—Ç—ã

–¢–µ–º–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∂–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞: {topic}
–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è: {target_audience}

–°–æ–∑–¥–∞–π –ø—Ä–æ–¥–∞—é—â–∏–π —Ç–µ–∫—Å—Ç:
"""

    def _get_ad_copy_prompt(self) -> str:
        """–ü—Ä–æ–º–ø—Ç –¥–ª—è —Ä–µ–∫–ª–∞–º–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞"""
        return """
–¢—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é —Ä–µ–∫–ª–∞–º–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤ –¥–ª—è digital-–ø–ª–æ—â–∞–¥–æ–∫.

–°–æ–∑–¥–∞–π —Ä–µ–∫–ª–∞–º–Ω—ã–π –∫—Ä–µ–∞—Ç–∏–≤ –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –≤:
- –Ø–Ω–¥–µ–∫—Å.–î–∏—Ä–µ–∫—Ç
- Google Ads  
- –í–ö–æ–Ω—Ç–∞–∫—Ç–µ
- Telegram
- –û–¥–Ω–æ–∫–ª–∞—Å—Å–Ω–∏–∫–∏

–§–û–†–ú–ê–¢–´:
1. –ö–æ—Ä–æ—Ç–∫–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è (–¥–æ 90 —Å–∏–º–≤–æ–ª–æ–≤)
2. –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è (–¥–æ 300 —Å–∏–º–≤–æ–ª–æ–≤)
3. –ü–æ—Å—Ç—ã –¥–ª—è —Å–æ—Ü—Å–µ—Ç–µ–π
4. Stories (–≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç)

–≠–õ–ï–ú–ï–ù–¢–´:
- –¶–µ–ø–ª—è—é—â–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫
- –û–ø–∏—Å–∞–Ω–∏–µ –≤—ã–≥–æ–¥—ã
- –ü—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é
- –•–µ—à—Ç–µ–≥–∏ (–¥–ª—è —Å–æ—Ü—Å–µ—Ç–µ–π)

–ü–†–ò–ù–¶–ò–ü–´:
- –û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ —Ü–µ–ª–µ–≤—É—é –∞—É–¥–∏—Ç–æ—Ä–∏—é
- –ß–µ—Ç–∫–æ–µ –£–¢–ü
- –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –≤—ã–≥–æ–¥—ã
- –°—Ä–æ—á–Ω–æ—Å—Ç—å –∏ –¥–µ—Ñ–∏—Ü–∏—Ç

–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–µ/—É—Å–ª—É–≥–µ: {product_info}
–ü–ª–æ—â–∞–¥–∫–∞ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è: {platform}
–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è: {target_audience}

–°–æ–∑–¥–∞–π —Ä–µ–∫–ª–∞–º–Ω—ã–µ –∫—Ä–µ–∞—Ç–∏–≤—ã:
"""

    def _get_social_post_prompt(self) -> str:
        """–ü—Ä–æ–º–ø—Ç –¥–ª—è —Å–æ—Ü—Å–µ—Ç–µ–π"""
        return """
–¢—ã ‚Äî SMM-—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç —Å —ç–∫—Å–ø–µ—Ä—Ç–∏–∑–æ–π –≤ —Å–æ–∑–¥–∞–Ω–∏–∏ –≤–∏—Ä—É—Å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞.

–°–æ–∑–¥–∞–π –ø–æ—Å—Ç –¥–ª—è —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç–µ–π:

–ü–õ–û–©–ê–î–ö–ò:
- –í–ö–æ–Ω—Ç–∞–∫—Ç–µ
- Telegram –∫–∞–Ω–∞–ª
- –û–¥–Ω–æ–∫–ª–∞—Å—Å–Ω–∏–∫–∏
- –î–∑–µ–Ω

–¢–ò–ü–´ –ü–û–°–¢–û–í:
1. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π
2. –†–∞–∑–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–π
3. –ü—Ä–æ–¥–∞—é—â–∏–π
4. –≠–∫—Å–ø–µ—Ä—Ç–Ω—ã–π
5. –í–æ–≤–ª–µ–∫–∞—é—â–∏–π

–°–¢–†–£–ö–¢–£–†–ê:
- –¶–µ–ø–ª—è—é—â–µ–µ –Ω–∞—á–∞–ª–æ
- –ü–æ–ª–µ–∑–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
- –ü—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é
- –•–µ—à—Ç–µ–≥–∏

–ü–†–ò–ï–ú–´:
- –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- –°—Ç–æ—Ä–∏—Ç–µ–ª–ª–∏–Ω–≥
- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
- –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è

–¢–µ–º–∞ –ø–æ—Å—Ç–∞: {topic}
–¢–∏–ø –ø–æ—Å—Ç–∞: {post_type}
–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è: {target_audience}

–°–æ–∑–¥–∞–π –≤–∏—Ä—É—Å–Ω—ã–π –ø–æ—Å—Ç:
"""

    def _get_email_marketing_prompt(self) -> str:
        """–ü—Ä–æ–º–ø—Ç –¥–ª—è email-—Ä–∞—Å—Å—ã–ª–∫–∏"""
        return """
–¢—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç –ø–æ email-–º–∞—Ä–∫–µ—Ç–∏–Ω–≥—É —Å –≤—ã—Å–æ–∫–∏–º –ø—Ä–æ—Ü–µ–Ω—Ç–æ–º –æ—Ç–∫—Ä—ã–≤–∞–µ–º–æ—Å—Ç–∏ –ø–∏—Å–µ–º.

–°–æ–∑–¥–∞–π email-–ø–∏—Å—å–º–æ –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏:

–¢–ò–ü–´ –ü–ò–°–ï–ú:
1. –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ
2. –ü—Ä–æ–¥–∞—é—â–µ–µ
3. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ
4. –†–µ–∞–∫—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω–æ–µ
5. –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –∫–æ—Ä–∑–∏–Ω–µ

–°–¢–†–£–ö–¢–£–†–ê:
- –¢–µ–º–∞ –ø–∏—Å—å–º–∞ (–ø—Ä–∏–≤–ª–µ–∫–∞—é—â–∞—è –≤–Ω–∏–º–∞–Ω–∏–µ)
- –ü—Ä–µ–≤—å—é —Ç–µ–∫—Å—Ç
- –ó–∞–≥–æ–ª–æ–≤–æ–∫
- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç
- –ü—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é
- PS (–ø–æ—Å—Ç—Å–∫—Ä–∏–ø—Ç—É–º)

–ü–†–ò–ù–¶–ò–ü–´:
- –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è
- –ß–µ—Ç–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- –ú–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å
- A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤

–¶–µ–ª—å –ø–∏—Å—å–º–∞: {goal}
–¢–∏–ø –ø–∏—Å—å–º–∞: {email_type}
–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è: {target_audience}

–°–æ–∑–¥–∞–π email-–ø–∏—Å—å–º–æ:
"""

    def _get_landing_page_prompt(self) -> str:
        """–ü—Ä–æ–º–ø—Ç –¥–ª—è –ª–µ–Ω–¥–∏–Ω–≥–∞"""
        return """
–¢—ã ‚Äî —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –≤—ã—Å–æ–∫–æ–∫–æ–Ω–≤–µ—Ä—Å–∏–æ–Ω–Ω—ã—Ö –ª–µ–Ω–¥–∏–Ω–≥-—Å—Ç—Ä–∞–Ω–∏—Ü.

–°–æ–∑–¥–∞–π —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ —Ç–µ–∫—Å—Ç—ã –¥–ª—è –ª–µ–Ω–¥–∏–Ω–≥–∞:

–ë–õ–û–ö–ò –õ–ï–ù–î–ò–ù–ì–ê:
1. –ó–∞–≥–æ–ª–æ–≤–æ–∫ + –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫
2. –ì–ª–∞–≤–Ω–∞—è –≤—ã–≥–æ–¥–∞
3. –ü—Ä–æ–±–ª–µ–º–∞
4. –†–µ—à–µ–Ω–∏–µ
5. –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞
6. –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
7. –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞
8. –í–æ–∑—Ä–∞–∂–µ–Ω–∏—è –∏ –æ—Ç–≤–µ—Ç—ã
9. –ü—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é
10. –ö–æ–Ω—Ç–∞–∫—Ç—ã

–ü–†–ò–ù–¶–ò–ü–´:
- –û–¥–Ω–∞ —Ü–µ–ª—å ‚Äî –æ–¥–Ω–æ –¥–µ–π—Å—Ç–≤–∏–µ
- –£–±—Ä–∞—Ç—å –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å social proof
- –ß–µ—Ç–∫–∏–µ CTA –∫–Ω–æ–ø–∫–∏

–ü–°–ò–•–û–õ–û–ì–ò–ß–ï–°–ö–ò–ï –¢–†–ò–ì–ì–ï–†–´:
- –î–µ—Ñ–∏—Ü–∏—Ç
- –ê–≤—Ç–æ—Ä–∏—Ç–µ—Ç
- –°–æ—Ü–∏–∞–ª—å–Ω–æ–µ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ
- –í–∑–∞–∏–º–Ω–æ—Å—Ç—å

–¢–æ–≤–∞—Ä/—É—Å–ª—É–≥–∞: {product_info}
–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è: {target_audience}
–¶–µ–ª—å –ª–µ–Ω–¥–∏–Ω–≥–∞: {goal}

–°–æ–∑–¥–∞–π —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ª–µ–Ω–¥–∏–Ω–≥–∞:
"""

    def _get_seo_content_prompt(self) -> str:
        """–ü—Ä–æ–º–ø—Ç –¥–ª—è SEO-–∫–æ–Ω—Ç–µ–Ω—Ç–∞"""
        return """
–¢—ã ‚Äî SEO-—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –∏ –∫–æ–Ω—Ç–µ–Ω—Ç-–º–∞—Ä–∫–µ—Ç–æ–ª–æ–≥.

–°–æ–∑–¥–∞–π SEO-–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç:

–¢–ò–ü–´ –ö–û–ù–¢–ï–ù–¢–ê:
1. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è —Å—Ç–∞—Ç—å—è
2. –ö–æ–º–º–µ—Ä—á–µ—Å–∫–∞—è —Å—Ç–∞—Ç—å—è
3. –û–ø–∏—Å–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
4. FAQ
5. –ì–∞–π–¥/–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

SEO-–¢–†–ï–ë–û–í–ê–ù–ò–Ø:
- –ü–ª–æ—Ç–Ω–æ—Å—Ç—å –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ 2-4%
- LSI-—Å–ª–æ–≤–∞ (—Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏ –±–ª–∏–∑–∫–∏–µ)
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ H1-H6
- –ú–µ—Ç–∞—Ç–µ–≥–∏ (title, description)
- –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –ø–µ—Ä–µ–ª–∏–Ω–∫–æ–≤–∫–∞

–°–¢–†–£–ö–¢–£–†–ê:
- Title (–¥–æ 60 —Å–∏–º–≤–æ–ª–æ–≤)
- Description (–¥–æ 160 —Å–∏–º–≤–æ–ª–æ–≤)
- H1 –∑–∞–≥–æ–ª–æ–≤–æ–∫
- –í–≤–µ–¥–µ–Ω–∏–µ
- –û—Å–Ω–æ–≤–Ω–∞—è —á–∞—Å—Ç—å —Å –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏
- –ó–∞–∫–ª—é—á–µ–Ω–∏–µ
- FAQ

–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞: {keywords}
–¢–µ–º–∞ —Å—Ç–∞—Ç—å–∏: {topic}
–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è: {target_audience}

–°–æ–∑–¥–∞–π SEO-–∫–æ–Ω—Ç–µ–Ω—Ç:
"""

    async def generate_content(self, content_type: str, **kwargs) -> Dict[str, str]:
        """
        –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º GPT
        
        Args:
            content_type (str): –¢–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (product_description, sales_text, etc.)
            **kwargs: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –ø—Ä–æ–º–ø—Ç–∞
            
        Returns:
            Dict[str, str]: –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
        """
        try:
            if content_type not in self.prompts:
                raise ValueError(f"–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ç–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞: {content_type}")
            
            # –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–æ–º–ø—Ç
            prompt = self.prompts[content_type]
            
            # –ó–∞–º–µ–Ω—è–µ–º –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
            for key, value in kwargs.items():
                placeholder = f"{{{key}}}"
                prompt = prompt.replace(placeholder, str(value))
            
            # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –∫ OpenAI
            response = await self._call_openai(prompt)
            
            # –ü–∞—Ä—Å–∏–º –æ—Ç–≤–µ—Ç
            result = self._parse_response(response, content_type)
            
            return result
            
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞: {str(e)}")
            return {"error": str(e)}

    async def _call_openai(self, prompt: str, model: str = "gpt-3.5-turbo") -> str:
        """
        –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤—ã–∑–æ–≤ OpenAI API
        
        Args:
            prompt (str): –ü—Ä–æ–º–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
            model (str): –ú–æ–¥–µ–ª—å GPT
            
        Returns:
            str: –û—Ç–≤–µ—Ç –æ—Ç API
        """
        try:
            response = await asyncio.to_thread(
                openai.ChatCompletion.create,
                model=model,
                messages=[
                    {"role": "system", "content": "–¢—ã ‚Äî –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –∫–æ–ø–∏—Ä–∞–π—Ç–µ—Ä –∏ –º–∞—Ä–∫–µ—Ç–æ–ª–æ–≥ —Å –æ–ø—ã—Ç–æ–º —Ä–∞–±–æ—Ç—ã –≤ e-commerce. –°–æ–∑–¥–∞–≤–∞–µ—à—å —Ç–æ–ª—å–∫–æ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π, –ø—Ä–æ–¥–∞—é—â–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ."},
                    {"role": "user", "content": prompt}
                ],
                max_tokens=2000,
                temperature=0.7,
                top_p=1.0,
                frequency_penalty=0.0,
                presence_penalty=0.0
            )
            
            return response.choices[0].message.content.strip()
            
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ OpenAI API: {str(e)}")
            raise

    def _parse_response(self, response: str, content_type: str) -> Dict[str, str]:
        """
        –ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞ –æ—Ç GPT –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
        
        Args:
            response (str): –û—Ç–≤–µ—Ç –æ—Ç GPT
            content_type (str): –¢–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            
        Returns:
            Dict[str, str]: –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        """
        result = {"content": response}
        
        # –î–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏–∑–≤–ª–µ–∫–∞–µ–º —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —á–∞—Å—Ç–∏
        if content_type == "product_description":
            result.update(self._parse_product_description(response))
        elif content_type == "product_card":
            result.update(self._parse_product_card(response))
        elif content_type == "sales_text":
            result.update(self._parse_sales_text(response))
        elif content_type == "ad_copy":
            result.update(self._parse_ad_copy(response))
        
        return result

    def _parse_product_description(self, response: str) -> Dict[str, str]:
        """–ü–∞—Ä—Å–∏–Ω–≥ –æ–ø–∏—Å–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞"""
        parts = {}
        
        # –ò–∑–≤–ª–µ–∫–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
        title_match = re.search(r'(?:–ó–ê–ì–û–õ–û–í–û–ö|–ó–∞–≥–æ–ª–æ–≤–æ–∫)[:\s]*([^\n]+)', response, re.IGNORECASE)
        if title_match:
            parts['title'] = title_match.group(1).strip()
        
        # –ò–∑–≤–ª–µ–∫–∞–µ–º —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
        chars_match = re.search(r'(?:–•–ê–†–ê–ö–¢–ï–†–ò–°–¢–ò–ö–ò|–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏)[:\s]*([^–ê-–Ø]+?)(?:[–ê-–Ø]|$)', response, re.IGNORECASE | re.DOTALL)
        if chars_match:
            parts['characteristics'] = chars_match.group(1).strip()
        
        return parts

    def _parse_product_card(self, response: str) -> Dict[str, str]:
        """–ü–∞—Ä—Å–∏–Ω–≥ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–∞"""
        parts = {}
        
        # –ò–∑–≤–ª–µ–∫–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ
        name_match = re.search(r'(?:–ù–ê–ó–í–ê–ù–ò–ï|–ù–∞–∑–≤–∞–Ω–∏–µ)[:\s]*([^\n]+)', response, re.IGNORECASE)
        if name_match:
            parts['name'] = name_match.group(1).strip()
        
        # –ò–∑–≤–ª–µ–∫–∞–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ
        desc_match = re.search(r'(?:–û–ü–ò–°–ê–ù–ò–ï|–û–ø–∏—Å–∞–Ω–∏–µ)[:\s]*([^–ê-–Ø]+?)(?:[–ê-–Ø]|$)', response, re.IGNORECASE | re.DOTALL)
        if desc_match:
            parts['description'] = desc_match.group(1).strip()
        
        return parts

    def _parse_sales_text(self, response: str) -> Dict[str, str]:
        """–ü–∞—Ä—Å–∏–Ω–≥ –ø—Ä–æ–¥–∞–∂–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞"""
        parts = {}
        
        # –ò–∑–≤–ª–µ–∫–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
        headline_match = re.search(r'(?:–ó–ê–ì–û–õ–û–í–û–ö|–ó–∞–≥–æ–ª–æ–≤–æ–∫)[:\s]*([^\n]+)', response, re.IGNORECASE)
        if headline_match:
            parts['headline'] = headline_match.group(1).strip()
        
        return parts

    def _parse_ad_copy(self, response: str) -> Dict[str, str]:
        """–ü–∞—Ä—Å–∏–Ω–≥ —Ä–µ–∫–ª–∞–º–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞"""
        parts = {}
        
        # –ò–∑–≤–ª–µ–∫–∞–µ–º –∫–æ—Ä–æ—Ç–∫–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
        short_ads = re.findall(r'(?:–ö–û–†–û–¢–ö–û–ï|–ö–æ—Ä–æ—Ç–∫–æ–µ)[:\s]*([^\n]+)', response, re.IGNORECASE)
        if short_ads:
            parts['short_ads'] = short_ads
        
        return parts

    def get_content_types(self) -> List[Dict[str, str]]:
        """
        –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        
        Returns:
            List[Dict[str, str]]: –°–ø–∏—Å–æ–∫ —Ç–∏–ø–æ–≤ —Å –æ–ø–∏—Å–∞–Ω–∏—è–º–∏
        """
        return [
            {"id": "product_description", "name": "üìù –û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞", "description": "–ü—Ä–æ–¥–∞—é—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–∞"},
            {"id": "product_card", "name": "üõí –ö–∞—Ä—Ç–æ—á–∫–∞ —Ç–æ–≤–∞—Ä–∞", "description": "–ü–æ–ª–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º –∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º–∏"},
            {"id": "sales_text", "name": "üí∞ –ü—Ä–æ–¥–∞–∂–Ω—ã–π —Ç–µ–∫—Å—Ç", "description": "–¢–µ–∫—Å—Ç –¥–ª—è –ø—Ä—è–º—ã—Ö –ø—Ä–æ–¥–∞–∂ –ø–æ —Ñ–æ—Ä–º—É–ª–µ AIDA"},
            {"id": "ad_copy", "name": "üì∫ –†–µ–∫–ª–∞–º–Ω—ã–π —Ç–µ–∫—Å—Ç", "description": "–ö—Ä–µ–∞—Ç–∏–≤—ã –¥–ª—è —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –∫–∞–º–ø–∞–Ω–∏–π"},
            {"id": "social_post", "name": "üì± –ü–æ—Å—Ç –¥–ª—è —Å–æ—Ü—Å–µ—Ç–µ–π", "description": "–ö–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç–µ–π"},
            {"id": "email_marketing", "name": "üìß Email-–ø–∏—Å—å–º–æ", "description": "–ü–∏—Å—å–º–∞ –¥–ª—è email-—Ä–∞—Å—Å—ã–ª–æ–∫"},
            {"id": "landing_page", "name": "üéØ –õ–µ–Ω–¥–∏–Ω–≥-—Å—Ç—Ä–∞–Ω–∏—Ü–∞", "description": "–¢–µ–∫—Å—Ç—ã –¥–ª—è –ø–æ—Å–∞–¥–æ—á–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü"},
            {"id": "seo_content", "name": "üîç SEO-–∫–æ–Ω—Ç–µ–Ω—Ç", "description": "–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ç–µ–∫—Å—Ç—ã"}
        ]

    async def analyze_competitors(self, product_name: str, count: int = 5) -> Dict[str, List[str]]:
        """
        –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ –¥–ª—è –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è
        
        Args:
            product_name (str): –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
            count (int): –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–º–µ—Ä–æ–≤
            
        Returns:
            Dict[str, List[str]]: –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤
        """
        prompt = f"""
–¢—ã ‚Äî –∞–Ω–∞–ª–∏—Ç–∏–∫ e-commerce. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Ç–æ–ø-{count} –ø—Ä–æ–¥–∞—é—â–∏—Ö –ø–æ–¥—Ö–æ–¥–æ–≤ –¥–ª—è —Ç–æ–≤–∞—Ä–∞ "{product_name}".

–ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å:
1. –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç—ã
2. –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –ø—Ä–æ–¥–∞–∂–Ω—ã–µ —Ñ—Ä–∞–∑—ã
3. –û—Å–Ω–æ–≤–Ω—ã–µ –≤—ã–≥–æ–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–¥–µ–ª—è—é—Ç
4. –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã
5. –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ç–æ—Ä–≥–æ–≤—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è

–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞: —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø–æ –∫–∞–∂–¥–æ–º—É –ø—É–Ω–∫—Ç—É.
"""
        
        try:
            response = await self._call_openai(prompt)
            
            # –ü–∞—Ä—Å–∏–º –æ—Ç–≤–µ—Ç –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
            result = {
                "keywords": [],
                "sales_phrases": [],
                "benefits": [],
                "emotional_triggers": [],
                "unique_propositions": []
            }
            
            # –ü—Ä–æ—Å—Ç–æ–π –ø–∞—Ä—Å–∏–Ω–≥ –ø–æ —á–∏—Å–ª–æ–≤—ã–º —Å–ø–∏—Å–∫–∞–º
            lines = response.split('\n')
            current_section = None
            
            for line in lines:
                line = line.strip()
                if '–∫–ª—é—á–µ–≤' in line.lower():
                    current_section = 'keywords'
                elif '—Ñ—Ä–∞–∑' in line.lower():
                    current_section = 'sales_phrases'
                elif '–≤—ã–≥–æ–¥' in line.lower():
                    current_section = 'benefits'
                elif '—Ç—Ä–∏–≥–≥–µ—Ä' in line.lower():
                    current_section = 'emotional_triggers'
                elif '–ø—Ä–µ–¥–ª–æ–∂–µ–Ω' in line.lower():
                    current_section = 'unique_propositions'
                elif line.startswith(('‚Ä¢', '-', '*')) and current_section:
                    clean_line = re.sub(r'^[‚Ä¢\-*]\s*', '', line)
                    if clean_line:
                        result[current_section].append(clean_line)
            
            return result
            
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤: {str(e)}")
            return {"error": str(e)}

    async def optimize_for_wb(self, content: str, keywords: List[str]) -> Dict[str, str]:
        """
        –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è Wildberries
        
        Args:
            content (str): –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
            keywords (List[str]): –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
            
        Returns:
            Dict[str, str]: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
        """
        keywords_str = ", ".join(keywords)
        
        prompt = f"""
–¢—ã ‚Äî SEO-—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ Wildberries. –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π —Ç–µ–∫—Å—Ç –¥–ª—è –ª—É—á—à–µ–≥–æ —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏—è.

–ò–°–•–û–î–ù–´–ô –¢–ï–ö–°–¢:
{content}

–ö–õ–Æ–ß–ï–í–´–ï –°–õ–û–í–ê:
{keywords_str}

–ó–ê–î–ê–ß–ò:
1. –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ –≤–Ω–µ–¥—Ä–∏ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
2. –£–ª—É—á—à–∏ —á–∏—Ç–∞–µ–º–æ—Å—Ç—å
3. –î–æ–±–∞–≤—å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω—ã
4. –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–π —Ç–µ–∫—Å—Ç
5. –°–¥–µ–ª–∞–π –±–æ–ª–µ–µ –ø—Ä–æ–¥–∞—é—â–∏–º

–¢–†–ï–ë–û–í–ê–ù–ò–Ø WB:
- –î–ª–∏–Ω–∞ –Ω–∞–∑–≤–∞–Ω–∏—è: 60-90 —Å–∏–º–≤–æ–ª–æ–≤
- –û–ø–∏—Å–∞–Ω–∏–µ: –¥–æ 5000 —Å–∏–º–≤–æ–ª–æ–≤
- –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –≤ –Ω–∞—á–∞–ª–µ
- –ë–µ–∑ –ø–µ—Ä–µ—Å–ø–∞–º–∞

–ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é:
"""
        
        try:
            response = await self._call_openai(prompt)
            
            return {
                "optimized_content": response,
                "keywords_used": keywords,
                "optimization_tips": "–ö–æ–Ω—Ç–µ–Ω—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è WB –ø–æ–∏—Å–∫–∞"
            }
            
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–ª—è WB: {str(e)}")
            return {"error": str(e)} 