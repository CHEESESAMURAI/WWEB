<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wild Analytics - Backend Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .card { background: white; padding: 20px; margin: 20px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .btn { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
        .btn:hover { background: #0056b3; }
        .result { background: #f8f9fa; border: 1px solid #dee2e6; padding: 10px; margin: 10px 0; border-radius: 4px; }
        .error { background: #f8d7da; color: #721c24; }
        .success { background: #d4edda; color: #155724; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>üîß Wild Analytics Backend Testing</h1>
    
    <div class="card">
        <h3>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤</h3>
        <button class="btn" onclick="testPort(8000)">–¢–µ—Å—Ç –ø–æ—Ä—Ç 8000</button>
        <button class="btn" onclick="testPort(8001)">–¢–µ—Å—Ç –ø–æ—Ä—Ç 8001</button>
        <button class="btn" onclick="testPort(3000)">–¢–µ—Å—Ç –ø–æ—Ä—Ç 3000</button>
        <div id="portResults"></div>
    </div>
    
    <div class="card">
        <h3>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–Ω–¥–ø–æ–π–Ω—Ç–æ–≤</h3>
        <button class="btn" onclick="testEndpoint('8000', '/')">8000: /</button>
        <button class="btn" onclick="testEndpoint('8000', '/docs')">8000: /docs</button>
        <button class="btn" onclick="testEndpoint('8000', '/auth/login')">8000: /auth/login</button>
        <br>
        <button class="btn" onclick="testEndpoint('8001', '/')">8001: /</button>
        <button class="btn" onclick="testEndpoint('8001', '/docs')">8001: /docs</button>
        <button class="btn" onclick="testEndpoint('8001', '/auth/login')">8001: /auth/login</button>
        <div id="endpointResults"></div>
    </div>
    
    <div class="card">
        <h3>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</h3>
        <button class="btn" onclick="testAuth(8000)">–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–∞ 8000</button>
        <button class="btn" onclick="testAuth(8001)">–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–∞ 8001</button>
        <div id="authResults"></div>
    </div>

    <script>
        async function testPort(port) {
            const resultDiv = document.getElementById('portResults');
            
            try {
                const response = await fetch(`http://localhost:${port}/`, { method: 'GET' });
                const text = await response.text();
                
                resultDiv.innerHTML += `
                    <div class="result success">
                        ‚úÖ –ü–æ—Ä—Ç ${port}: –î–æ—Å—Ç—É–ø–µ–Ω (${response.status})
                        <br>–û—Ç–≤–µ—Ç: ${text.substring(0, 100)}...
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML += `
                    <div class="result error">
                        ‚ùå –ü–æ—Ä—Ç ${port}: –ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω - ${error.message}
                    </div>
                `;
            }
        }
        
        async function testEndpoint(port, endpoint) {
            const resultDiv = document.getElementById('endpointResults');
            
            try {
                const url = `http://localhost:${port}${endpoint}`;
                let response;
                
                if (endpoint === '/auth/login') {
                    response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            email: "test@example.com",
                            password: "testpassword"
                        })
                    });
                } else {
                    response = await fetch(url, { method: 'GET' });
                }
                
                const text = await response.text();
                
                resultDiv.innerHTML += `
                    <div class="result ${response.ok ? 'success' : 'error'}">
                        ${response.ok ? '‚úÖ' : '‚ùå'} ${port}${endpoint}: ${response.status}
                        <br>–û—Ç–≤–µ—Ç: ${text.substring(0, 200)}...
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML += `
                    <div class="result error">
                        ‚ùå ${port}${endpoint}: –û—à–∏–±–∫–∞ - ${error.message}
                    </div>
                `;
            }
        }
        
        async function testAuth(port) {
            const resultDiv = document.getElementById('authResults');
            
            try {
                const response = await fetch(`http://localhost:${port}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: "test@example.com",
                        password: "testpassword"
                    })
                });
                
                const data = await response.json();
                
                if (response.ok && data.access_token) {
                    resultDiv.innerHTML += `
                        <div class="result success">
                            ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–∞ ${port}: –£—Å–ø–µ—à–Ω–æ!
                            <br>–¢–æ–∫–µ–Ω: ${data.access_token.substring(0, 50)}...
                        </div>
                    `;
                    
                    // –¢–µ—Å—Ç–∏—Ä—É–µ–º –∑–∞—â–∏—â–µ–Ω–Ω—ã–π —ç–Ω–¥–ø–æ–π–Ω—Ç
                    const dashResponse = await fetch(`http://localhost:${port}/user/dashboard`, {
                        headers: { 'Authorization': `Bearer ${data.access_token}` }
                    });
                    
                    if (dashResponse.ok) {
                        const dashData = await dashResponse.json();
                        resultDiv.innerHTML += `
                            <div class="result success">
                                ‚úÖ Dashboard –Ω–∞ ${port}: –î–æ—Å—Ç—É–ø–µ–Ω!
                                <br>–î–∞–Ω–Ω—ã–µ: ${JSON.stringify(dashData).substring(0, 100)}...
                            </div>
                        `;
                    }
                } else {
                    resultDiv.innerHTML += `
                        <div class="result error">
                            ‚ùå –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–∞ ${port}: –ù–µ —É–¥–∞–ª–∞—Å—å
                            <br>–û—Ç–≤–µ—Ç: ${JSON.stringify(data)}
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML += `
                    <div class="result error">
                        ‚ùå –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–∞ ${port}: –û—à–∏–±–∫–∞ - ${error.message}
                    </div>
                `;
            }
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            setTimeout(() => {
                testPort(8000);
                testPort(8001);
            }, 1000);
        };
    </script>
</body>
</html>
