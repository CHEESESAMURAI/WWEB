<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ MPStats</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .success { background: #d4edda; border-color: #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border-color: #f5c6cb; color: #721c24; }
        .info { background: #d1ecf1; border-color: #bee5eb; color: #0c5460; }
        .photo-test { text-align: center; }
        .photo-test img { max-width: 300px; border-radius: 10px; margin: 10px; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .chart-data { max-height: 200px; overflow-y: auto; background: #f8f9fa; padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ –¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∞–Ω–∞–ª–∏–∑–∞ —Ç–æ–≤–∞—Ä–∞</h1>
        
        <div class="test-section info">
            <h3>üìã –¢–µ—Å—Ç–∏—Ä—É–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏</h3>
            <ul>
                <li>‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —Ç–æ–≤–∞—Ä–∞ –∏–∑ MPStats</li>
                <li>‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤ MPStats</li>
                <li>‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ –µ–¥–∏–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>üî¨ –¢–µ—Å—Ç –¥–∞–Ω–Ω—ã—Ö</h3>
            <button onclick="testMPStatsData()">–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å MPStats API</button>
            <div id="apiResult"></div>
        </div>

        <div class="test-section">
            <h3>üì∏ –¢–µ—Å—Ç —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏</h3>
            <div class="photo-test">
                <p>–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π URL: <span id="originalUrl">–ù–µ –∑–∞–≥—Ä—É–∂–µ–Ω</span></p>
                <p>–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π URL: <span id="fixedUrl">–ù–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω</span></p>
                <div id="photoContainer"></div>
            </div>
        </div>

        <div class="test-section">
            <h3>üìä –¢–µ—Å—Ç –¥–∞–Ω–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤</h3>
            <div id="chartDataContainer"></div>
        </div>
    </div>

    <script>
        async function testMPStatsData() {
            const resultDiv = document.getElementById('apiResult');
            resultDiv.innerHTML = '<p>üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>';
            
            try {
                const response = await fetch('http://localhost:8000/mpstats/advanced-analysis', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        article: '446467818',
                        date_from: '2023-10-27',
                        date_to: '2023-11-25',
                        fbs: 1
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const data = await response.json();
                
                // –¢–µ—Å—Ç —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏
                testPhoto(data.basic_info);
                
                // –¢–µ—Å—Ç –≥—Ä–∞—Ñ–∏–∫–æ–≤
                testChartData(data.charts);
                
                resultDiv.innerHTML = `
                    <div class="success">
                        <h4>‚úÖ API —Ç–µ—Å—Ç —É—Å–ø–µ—à–µ–Ω!</h4>
                        <p><strong>–¢–æ–≤–∞—Ä:</strong> ${data.basic_info.name}</p>
                        <p><strong>–ü—Ä–æ–¥–∞–∂:</strong> ${data.sales_metrics.sales.toLocaleString()} —à—Ç.</p>
                        <p><strong>–í—ã—Ä—É—á–∫–∞:</strong> ${data.sales_metrics.revenue.toLocaleString()} ‚ÇΩ</p>
                    </div>
                `;
                
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        <h4>‚ùå –û—à–∏–±–∫–∞ API</h4>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        function testPhoto(basicInfo) {
            const originalUrlSpan = document.getElementById('originalUrl');
            const fixedUrlSpan = document.getElementById('fixedUrl');
            const photoContainer = document.getElementById('photoContainer');
            
            if (basicInfo.thumb_middle || basicInfo.thumb) {
                const originalUrl = basicInfo.thumb_middle || basicInfo.thumb;
                const fixedUrl = originalUrl.startsWith('//') ? `https:${originalUrl}` : originalUrl;
                
                originalUrlSpan.textContent = originalUrl;
                fixedUrlSpan.textContent = fixedUrl;
                
                photoContainer.innerHTML = `
                    <img src="${fixedUrl}" alt="–¢–æ–≤–∞—Ä" 
                         onload="this.parentElement.insertAdjacentHTML('beforeend', '<div class=\\"success\\">‚úÖ –§–æ—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ!</div>')"
                         onerror="this.parentElement.insertAdjacentHTML('beforeend', '<div class=\\"error\\">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ</div>')">
                `;
            } else {
                photoContainer.innerHTML = '<div class="error">‚ùå URL —Ñ–æ—Ç–æ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –¥–∞–Ω–Ω—ã—Ö</div>';
            }
        }

        function testChartData(charts) {
            const container = document.getElementById('chartDataContainer');
            
            let chartsHtml = '';
            
            Object.entries(charts).forEach(([chartName, chartData]) => {
                if (Array.isArray(chartData) && chartData.length > 0) {
                    const hasData = chartData.some(value => value > 0);
                    const statusClass = hasData ? 'success' : 'info';
                    const statusIcon = hasData ? '‚úÖ' : '‚ÑπÔ∏è';
                    
                    chartsHtml += `
                        <div class="${statusClass}" style="margin: 10px 0;">
                            <h4>${statusIcon} ${chartName}</h4>
                            <p><strong>–¢–æ—á–µ–∫ –¥–∞–Ω–Ω—ã—Ö:</strong> ${chartData.length}</p>
                            <p><strong>–î–∏–∞–ø–∞–∑–æ–Ω:</strong> ${Math.min(...chartData)} - ${Math.max(...chartData)}</p>
                            <div class="chart-data">
                                <strong>–ü–µ—Ä–≤—ã–µ 10 –∑–Ω–∞—á–µ–Ω–∏–π:</strong> [${chartData.slice(0, 10).join(', ')}]
                            </div>
                        </div>
                    `;
                }
            });
            
            container.innerHTML = chartsHtml || '<div class="error">‚ùå –î–∞–Ω–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            console.log('üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏...');
            testMPStatsData();
        };
    </script>
</body>
</html> 