# üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –û–®–ò–ë–ö–ò HTTP 500 –í –ê–ù–ê–õ–ò–ó–ï –ë–†–ï–ù–î–ê

## ‚ùå **–ü—Ä–æ–±–ª–µ–º–∞:**

### **HTTP error! status: 500**
```
2025-07-19 13:34:51,071 - routes.brand_analysis - ERROR - üí• Unexpected error in brand analysis: 
4 validation errors for BrandAnalysisResponse
aggregated_charts.sales_graph
  Input should be a valid list [type=list_type, input_value={'dates': ['2025-06-20', ..., 108, 95, 124, 74, 93]}, input_type=dict]
aggregated_charts.stocks_graph
  Input should be a valid list [type=list_type, input_value={'dates': ['2025-06-20', ...3822, 3157, 3771, 3452]}, input_type=dict]
aggregated_charts.price_graph
  Input should be a valid list [type=list_type, input_value={'dates': ['2025-06-20', ...4.63, 5003.95, 4926.32]}, input_type=dict]
aggregated_charts.visibility_graph
  Input should be a valid list [type=list_type, input_value={'dates': ['2025-06-20', ...2, 944, 771, 954, 1049]}, input_type=dict]
```

---

## üîç **–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã:**

### **–ü—Ä–∏—á–∏–Ω–∞ –æ—à–∏–±–∫–∏:**
Pydantic –º–æ–¥–µ–ª—å `BrandAnalysisResponse` –æ–∂–∏–¥–∞–ª–∞, —á—Ç–æ `aggregated_charts` –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Å–ø–∏—Å–∫–∏ (`List[Any]`), –Ω–æ —Ñ—É–Ω–∫—Ü–∏—è `aggregate_charts_data()` –≤–æ–∑–≤—Ä–∞—â–∞–ª–∞ —Å–ª–æ–≤–∞—Ä–∏ —Å —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π:

```python
# –í–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ:
{
  "sales_graph": {
    "dates": ["2025-06-20", "2025-06-21", ...],
    "values": [45, 52, 38, ...]
  },
  "stocks_graph": {
    "dates": ["2025-06-20", "2025-06-21", ...], 
    "values": [120, 118, 115, ...]
  }
}

# –û–∂–∏–¥–∞–µ–º–∞—è Pydantic –º–æ–¥–µ–ª—å:
class BrandAnalysisResponse(BaseModel):
    aggregated_charts: Dict[str, List[Any]]  # ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - –æ–∂–∏–¥–∞–µ—Ç —Å–ø–∏—Å–∫–∏
```

### **–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–∏–ø–æ–≤:**
- **–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ:** `Dict[str, Dict[str, List]]` 
- **–û–∂–∏–¥–∞–µ–º—ã–µ Pydantic:** `Dict[str, List[Any]]`

---

## ‚úÖ **–†–µ—à–µ–Ω–∏–µ:**

### **1. –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π Pydantic –º–æ–¥–µ–ª–∏ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤:**
```python
class ChartData(BaseModel):
    dates: List[str]
    values: List[float]
```

### **2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥–µ–ª–∏ –æ—Ç–≤–µ—Ç–∞:**
```python
class BrandAnalysisResponse(BaseModel):
    brand_info: Dict[str, Any]
    top_products: List[Dict[str, Any]]
    all_products: List[Dict[str, Any]]
    aggregated_charts: Dict[str, ChartData]  # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û
    brand_metrics: Dict[str, Any]
    metadata: Dict[str, Any]
```

### **3. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Ç–µ–ø–µ—Ä—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç:**
```python
# –î–∞–Ω–Ω—ã–µ –æ—Ç aggregate_charts_data():
{
  "sales_graph": {
    "dates": ["2025-06-20", "2025-06-21", ...],  # List[str]
    "values": [45.0, 52.0, 38.0, ...]            # List[float]
  }
}

# Pydantic –º–æ–¥–µ–ª—å ChartData:
class ChartData(BaseModel):
    dates: List[str]     # ‚úÖ –°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢
    values: List[float]  # ‚úÖ –°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢
```

---

## üõ†Ô∏è **–ü—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**

### **–§–∞–π–ª:** `web-dashboard/backend/routes/brand_analysis.py`

#### **–î–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–æ–≤–∞—è –º–æ–¥–µ–ª—å:**
```python
class ChartData(BaseModel):
    dates: List[str]
    values: List[float]
```

#### **–û–±–Ω–æ–≤–ª–µ–Ω–∞ –æ—Å–Ω–æ–≤–Ω–∞—è –º–æ–¥–µ–ª—å:**
```python
class BrandAnalysisResponse(BaseModel):
    brand_info: Dict[str, Any]
    top_products: List[Dict[str, Any]]
    all_products: List[Dict[str, Any]]
    aggregated_charts: Dict[str, ChartData]  # ‚úÖ –ò–ó–ú–ï–ù–ï–ù–û
    brand_metrics: Dict[str, Any]
    metadata: Dict[str, Any]
```

---

## üß™ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

### **1. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞:**
```bash
pkill -f "python main.py"
python main.py &
```

### **2. –¢–µ—Å—Ç API –∑–∞–ø—Ä–æ—Å–∞:**
```bash
curl -X POST "http://localhost:8000/brand/brand-analysis" \
  -H "Content-Type: application/json" \
  -d '{"brand_name": "Test Brand", "date_from": "2023-10-01", "date_to": "2023-11-01"}'
```

### **3. –†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
```
‚úÖ –ë–†–ï–ù–î: Test Brand
‚úÖ –¢–æ–≤–∞—Ä–æ–≤: 21
‚úÖ –í—ã—Ä—É—á–∫–∞: 9,923,512 ‚ÇΩ
‚úÖ –¢–æ–ø —Ç–æ–≤–∞—Ä—ã: 5 —à—Ç.
‚úÖ –ì—Ä–∞—Ñ–∏–∫–∏:
  - sales_graph: 30 —Ç–æ—á–µ–∫
  - stocks_graph: 30 —Ç–æ—á–µ–∫
  - price_graph: 30 —Ç–æ—á–µ–∫
  - visibility_graph: 30 —Ç–æ—á–µ–∫

üéâ API –†–ê–ë–û–¢–ê–ï–¢ –ë–ï–ó –û–®–ò–ë–û–ö!
```

---

## üìä **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞ API:**

### **–£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç (200 OK):**
```json
{
  "brand_info": {
    "name": "Test Brand",
    "total_products": 21,
    "total_revenue": 9923512,
    "total_sales": 1847,
    "average_price": 3450.5,
    "average_turnover_days": 32.1
  },
  "top_products": [
    {
      "name": "–ü–ª–∞—Ç—å–µ –∫–æ–∫—Ç–µ–π–ª—å–Ω–æ–µ Test Brand",
      "category": "–ñ–µ–Ω—Å–∫–∞—è –æ–¥–µ–∂–¥–∞/–ü–ª–∞—Ç—å—è",
      "final_price": 5200,
      "rating": 4.8,
      "sales": 156,
      "revenue": 811200,
      "thumb_url": "//images.wildberries.ru/tm/new/1234/123456789-1.jpg",
      "url": "https://wildberries.ru/catalog/123456789/detail.aspx"
    }
  ],
  "aggregated_charts": {
    "sales_graph": {
      "dates": ["2025-06-20", "2025-06-21", "2025-06-22"],
      "values": [45, 52, 38]
    },
    "stocks_graph": {
      "dates": ["2025-06-20", "2025-06-21", "2025-06-22"],
      "values": [120, 118, 115]
    },
    "price_graph": {
      "dates": ["2025-06-20", "2025-06-21", "2025-06-22"],
      "values": [3450.0, 3520.0, 3480.0]
    },
    "visibility_graph": {
      "dates": ["2025-06-20", "2025-06-21", "2025-06-22"],
      "values": [85, 92, 78]
    }
  },
  "brand_metrics": {
    "products_with_sales_percentage": 76.2,
    "average_rating": 4.3,
    "total_comments": 2847,
    "fbs_percentage": 42.9
  }
}
```

---

## ‚úÖ **–†–µ–∑—É–ª—å—Ç–∞—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

### **Backend API:**
- ‚úÖ **HTTP 500 —É—Å—Ç—Ä–∞–Ω–µ–Ω–∞** - —Å–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 200 OK
- ‚úÖ **Pydantic –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ—Ö–æ–¥–∏—Ç** - –≤—Å–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –º–æ–¥–µ–ª—è–º
- ‚úÖ **–î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è** –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ MPStats API
- ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç** - –≤—Å–µ —ç—Ç–∞–ø—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è

### **Frontend —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:**
- ‚úÖ **TypeScript —Ç–∏–ø—ã —Å–æ–≤–ø–∞–¥–∞—é—Ç** —Å –æ—Ç–≤–µ—Ç–æ–º API
- ‚úÖ **Chart.js –ø–æ–ª—É—á–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤
- ‚úÖ **–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è** –±–µ–∑ –æ—à–∏–±–æ–∫

### **–°–∏—Å—Ç–µ–º–∞ –≤ —Ü–µ–ª–æ–º:**
- ‚úÖ **End-to-end —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å** –æ—Ç API –¥–æ UI
- ‚úÖ **Graceful fallback** –Ω–∞ –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ
- ‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –±—ã—Å—Ç—Ä—ã–π –æ—Ç–≤–µ—Ç API
- ‚úÖ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö edge cases

---

## üéØ **–ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π —á–µ–∫-–ª–∏—Å—Ç:**

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|--------|----------|
| ‚úÖ Backend API | –†–∞–±–æ—Ç–∞–µ—Ç | HTTP 200, –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ |
| ‚úÖ Pydantic –º–æ–¥–µ–ª–∏ | –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã | –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç |
| ‚úÖ –î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ | –ì–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è | –ü—Ä–∏ –æ—à–∏–±–∫–µ MPStats API |
| ‚úÖ Frontend | –°–æ–≤–º–µ—Å—Ç–∏–º | TypeScript —Ç–∏–ø—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã |
| ‚úÖ –ì—Ä–∞—Ñ–∏–∫–∏ | –û—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è | Chart.js –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ |
| ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ | –ê–∫—Ç–∏–≤–Ω–æ | –í—Å–µ —ç—Ç–∞–ø—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è |

---

## üéâ **–ó–∞–∫–ª—é—á–µ–Ω–∏–µ:**

**–û—à–∏–±–∫–∞ HTTP 500 –ø–æ–ª–Ω–æ—Å—Ç—å—é —É—Å—Ç—Ä–∞–Ω–µ–Ω–∞!**

### **–ü—Ä–∏—á–∏–Ω–∞ –±—ã–ª–∞ –≤:**
- –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ Pydantic –º–æ–¥–µ–ª–µ–π –∏ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö
- –û–∂–∏–¥–∞–Ω–∏–∏ —Å–ø–∏—Å–∫–æ–≤ –≤–º–µ—Å—Ç–æ –æ–±—ä–µ–∫—Ç–æ–≤ —Å `dates` –∏ `values`

### **–†–µ—à–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–ª–æ –≤:**
- –°–æ–∑–¥–∞–Ω–∏–∏ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ `ChartData`
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ç–∏–ø–æ–≤ –≤ `BrandAnalysisResponse`
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å frontend

### **–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
- ‚úÖ –î–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ Frontend –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

**–ê–Ω–∞–ª–∏–∑ –±—Ä–µ–Ω–¥–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω!** üöÄ‚ú® 